

// import React from 'react';

// // Icons
// const ArrowLeftIcon = () => (
//   <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <line x1="19" y1="12" x2="5" y2="12"/>
//     <polyline points="12,19 5,12 12,5"/>
//   </svg>
// );

// const DownloadIcon = () => (
//   <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
//     <polyline points="7,10 12,15 17,10"/>
//     <line x1="12" y1="15" x2="12" y2="3"/>
//   </svg>
// );

// const CheckIcon = () => (
//   <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
//     <polyline points="22,4 12,14.01 9,11.01"/>
//   </svg>
// );

// const RefreshIcon = () => (
//   <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M1 4v6h6"/>
//     <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
//   </svg>
// );

// const MailIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
//     <polyline points="22,6 12,13 2,6"/>
//   </svg>
// );

// const PhoneIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
//   </svg>
// );

// const UserIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
//     <circle cx="12" cy="7" r="4"/>
//   </svg>
// );

// const BuildingIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M3 21h18"/>
//     <path d="M5 21V7l8-4v18"/>
//     <path d="M19 21V11l-6-4"/>
//   </svg>
// );

// const LinkedinIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/>
//     <rect x="2" y="9" width="4" height="12"/>
//     <circle cx="4" cy="4" r="2"/>
//   </svg>
// );

// const GlobeIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <circle cx="12" cy="12" r="10"/>
//     <line x1="2" y1="12" x2="22" y2="12"/>
//     <path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/>
//   </svg>
// );

// const LocationIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
//     <circle cx="12" cy="10" r="3"/>
//   </svg>
// );

// const MapPinIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
//     <circle cx="12" cy="10" r="3"/>
//   </svg>
// );

// const InfoIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <circle cx="12" cy="12" r="10"/>
//     <line x1="12" y1="16" x2="12" y2="12"/>
//     <line x1="12" y1="8" x2="12.01" y2="8"/>
//   </svg>
// );

// const TwitterIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
//   </svg>
// );

// const FacebookIcon = () => (
//   <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
//     <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/>
//   </svg>
// );

// const DomainSearchResults = ({ 
//   resultData, 
//   formData, 
//   submissionTime, 
//   onBack, 
//   onNewSearch,
//   companyData // Add this prop to receive company data
// }) => {
  
//   // Extract unique company information from results
//   const getCompanyInfo = () => {
//     if (!resultData || !Array.isArray(resultData)) return null;
    
//     // Get unique company names
//     const companies = [...new Set(resultData.map(lead => lead.company).filter(Boolean))];
    
//     // For now, we'll aggregate information about the primary company
//     if (companies.length > 0) {
//       const primaryCompany = companies[0];
//       const companyLeads = resultData.filter(lead => lead.company === primaryCompany);
      
//       // Extract unique departments
//       const departments = [...new Set(companyLeads.map(lead => lead.department).filter(Boolean))];
      
//       // Extract unique positions/roles
//       const positions = [...new Set(companyLeads.map(lead => lead.position).filter(Boolean))];
      
//       // Count by seniority level
//       const seniorityLevels = companyLeads.reduce((acc, lead) => {
//         if (lead.seniority) {
//           acc[lead.seniority] = (acc[lead.seniority] || 0) + 1;
//         }
//         return acc;
//       }, {});
      
//       // Extract unique email addresses from leads
//       const emailAddresses = [...new Set(companyLeads.map(lead => lead.email).filter(Boolean))];
      
//       // Merge with company data if provided
//       return {
//         name: companyData?.name || primaryCompany,
//         domain: formData.domain,
//         employeeCount: companyLeads.length,
//         departments: departments,
//         positions: positions,
//         seniorityLevels: seniorityLevels,
//         emailPattern: `@${formData.domain}`,
//         emailAddresses: emailAddresses,
//         // Company specific fields from API
//         logo: companyData?.logo || null,
//         description: companyData?.description || null,
//         industry: companyData?.industry || resultData[0]?.industry || null,
//         size: companyData?.size || resultData[0]?.companySize || null,
//         location: companyData?.location || resultData[0]?.companyLocation || null,
//         latitude: companyData?.latitude || null,
//         longitude: companyData?.longitude || null,
//         founded: companyData?.founded || resultData[0]?.companyFounded || null,
//         website: companyData?.website || `https://${formData.domain}`,
//         linkedin: companyData?.linkedin || null,
//         twitter: companyData?.twitter || null,
//         facebook: companyData?.facebook || null,
//         type: companyData?.type || null,
//         revenue: companyData?.revenue || null,
//         technologies: companyData?.technologies || [],
//         phone: companyData?.phone || null,
//         address: companyData?.address || null,
//         city: companyData?.city || null,
//         state: companyData?.state || null,
//         country: companyData?.country || null,
//         postalCode: companyData?.postalCode || null
//       };
//     }
    
//     return null;
//   };

//   const companyInfo = getCompanyInfo();

//   // Download results as CSV
//   const downloadAsCSV = () => {
//     if (!resultData || !Array.isArray(resultData)) return;
    
//     const headers = [
//       'Full Name', 'First Name', 'Last Name', 'Email', 'Phone Number', 
//       'Company', 'Position', 'Department', 'Seniority', 'LinkedIn Profile',
//       'Confidence', 'Verification Status', 'Source'
//     ];
    
//     const csvContent = [
//       headers.join(','),
//       ...resultData.map(row => [
//         `"${(row.fullName || '').replace(/"/g, '""')}"`,
//         `"${(row.firstName || '').replace(/"/g, '""')}"`,
//         `"${(row.lastName || '').replace(/"/g, '""')}"`,
//         `"${(row.email || '').replace(/"/g, '""')}"`,
//         `"${(row.phoneNumber || '').replace(/"/g, '""')}"`,
//         `"${(row.company || '').replace(/"/g, '""')}"`,
//         `"${(row.position || '').replace(/"/g, '""')}"`,
//         `"${(row.department || '').replace(/"/g, '""')}"`,
//         `"${(row.seniority || '').replace(/"/g, '""')}"`,
//         `"${(row.linkedinProfile || '').replace(/"/g, '""')}"`,
//         `"${(row.confidence || '').toString().replace(/"/g, '""')}"`,
//         `"${(row.verificationStatus || '').replace(/"/g, '""')}"`,
//         `"${(row.source || '').replace(/"/g, '""')}"`
//       ].join(','))
//     ].join('\n');
    
//     const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
//     const link = document.createElement('a');
//     const url = URL.createObjectURL(blob);
//     link.setAttribute('href', url);
//     link.setAttribute('download', `domain_leads_${formData.domain}_${new Date().toISOString().split('T')[0]}.csv`);
//     link.style.visibility = 'hidden';
//     document.body.appendChild(link);
//     link.click();
//     document.body.removeChild(link);
//   };

//   // Download results as JSON
//   const downloadAsJSON = () => {
//     if (!resultData) return;
    
//     const jsonData = {
//       searchParameters: formData,
//       submissionTime: submissionTime,
//       extractionDate: new Date().toISOString(),
//       totalResults: Array.isArray(resultData) ? resultData.length : 0,
//       companyInfo: companyInfo,
//       results: resultData
//     };
    
//     const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
//     const link = document.createElement('a');
//     const url = URL.createObjectURL(blob);
//     link.setAttribute('href', url);
//     link.setAttribute('download', `domain_leads_${formData.domain}_${new Date().toISOString().split('T')[0]}.json`);
//     link.style.visibility = 'hidden';
//     document.body.appendChild(link);
//     link.click();
//     document.body.removeChild(link);
//   };

//   const getResultsCount = () => {
//     return Array.isArray(resultData) ? resultData.length : 0;
//   };

//   const getConfidenceColor = (confidence) => {
//     if (confidence >= 80) return 'bg-green-100 text-green-800';
//     if (confidence >= 60) return 'bg-yellow-100 text-yellow-800';
//     return 'bg-red-100 text-red-800';
//   };

//   const getVerificationStatusColor = (status) => {
//     switch (status?.toLowerCase()) {
//       case 'verified': return 'bg-green-100 text-green-800';
//       case 'invalid': return 'bg-red-100 text-red-800';
//       case 'unknown': return 'bg-gray-100 text-gray-800';
//       default: return 'bg-gray-100 text-gray-600';
//     }
//   };

//   return (
//     <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 animate-slideIn">
//       <div className="max-w-7xl mx-auto">
//         {/* Header Section */}
//         <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
//           <div className="flex flex-col lg:flex-row lg:items-center justify-between mb-6">
//             <div className="flex items-center mb-4 lg:mb-0">
//               <button
//                 onClick={onBack}
//                 className="mr-4 p-2 text-gray-600 hover:text-gray-800 transition-colors rounded-lg hover:bg-gray-100"
//               >
//                 <ArrowLeftIcon />
//               </button>
//               <div>
//                 <h1 className="text-2xl lg:text-3xl font-bold text-gray-800">Domain Lead Results</h1>
//                 <p className="text-gray-600 mt-1">
//                   Found <span className="font-bold text-teal-600">{getResultsCount()} leads</span> from{' '}
//                   <span className="font-medium text-teal-600">{formData.domain}</span>
//                 </p>
//               </div>
//             </div>
            
//             <div className="flex items-center space-x-4">
//               <div className="text-center">
//                 <div className="flex items-center justify-center w-12 h-12 bg-green-100 rounded-full mb-2">
//                   <CheckIcon />
//                 </div>
//                 <p className="text-sm text-gray-600">Completed in {submissionTime}s</p>
//               </div>
//             </div>
//           </div>
          
//           {/* Search Summary */}
//           <div className="bg-gray-50 rounded-lg p-4 mb-6">
//             <h3 className="font-medium text-gray-800 mb-2">Search Parameters:</h3>
//             <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
//               <div>
//                 <span className="text-gray-500">Domain:</span>
//                 <p className="font-medium text-gray-800">{formData.domain}</p>
//               </div>
//               <div>
//                 <span className="text-gray-500">Results Requested:</span>
//                 <p className="font-medium text-gray-800">{formData.results}</p>
//               </div>
//               <div>
//                 <span className="text-gray-500">API Key:</span>
//                 <p className="font-medium text-gray-800">{formData.apiKey ? 'Premium Mode' : 'Standard Mode'}</p>
//               </div>
//               <div>
//                 <span className="text-gray-500">Source:</span>
//                 <p className="font-medium text-gray-800">Hunter.io</p>
//               </div>
//             </div>
//           </div>
          
//           {/* Action Buttons */}
//           <div className="flex flex-wrap gap-3">
//             <button
//               onClick={downloadAsCSV}
//               className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
//             >
//               <DownloadIcon />
//               <span className="ml-2">Download CSV</span>
//             </button>
            
//             <button
//               onClick={downloadAsJSON}
//               className="flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
//             >
//               <DownloadIcon />
//               <span className="ml-2">Download JSON</span>
//             </button>
            
//             <button
//               onClick={onNewSearch}
//               className="flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
//             >
//               <RefreshIcon />
//               <span className="ml-2">New Search</span>
//             </button>
            
//             <div className="flex items-center px-4 py-2 bg-gray-100 rounded-lg">
//               <span className="text-sm text-gray-600">
//                 Domain: <span className="font-medium text-teal-600">{formData.domain}</span>
//               </span>
//             </div>
//           </div>
//         </div>

//         {/* Company Information Section */}
//         {companyInfo && (
//           <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
//             <h2 className="text-xl font-bold text-gray-800 mb-6 flex items-center">
//               <BuildingIcon />
//               <span className="ml-2">Company Information</span>
//             </h2>
            
//             {/* Company Header with Logo */}
//             <div className="flex flex-col md:flex-row gap-6 mb-6">
//               {/* Logo Section */}
//               {companyInfo.logo && (
//                 <div className="flex-shrink-0">
//                   <img 
//                     src={companyInfo.logo} 
//                     alt={`${companyInfo.name} logo`}
//                     className="w-24 h-24 object-contain rounded-lg border border-gray-200 p-2 bg-white"
//                     onError={(e) => {
//                       e.target.style.display = 'none';
//                     }}
//                   />
//                 </div>
//               )}
              
//               {/* Company Basic Info */}
//               <div className="flex-grow">
//                 <h3 className="text-2xl font-bold text-gray-900 mb-2">{companyInfo.name}</h3>
//                 {companyInfo.description && (
//                   <p className="text-gray-700 mb-4">{companyInfo.description}</p>
//                 )}
                
//                 {/* Quick Info Tags */}
//                 <div className="flex flex-wrap gap-2 mb-4">
//                   {companyInfo.industry && (
//                     <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
//                       {companyInfo.industry}
//                     </span>
//                   )}
//                   {companyInfo.type && (
//                     <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
//                       {companyInfo.type}
//                     </span>
//                   )}
//                   {companyInfo.size && (
//                     <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
//                       {companyInfo.size} employees
//                     </span>
//                   )}
//                 </div>
//               </div>
//             </div>
            
//             {/* Detailed Company Information Grid */}
//             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
//               {/* Contact Information */}
//               <div className="space-y-4">
//                 <h4 className="font-semibold text-gray-800 mb-3">Contact Information</h4>
                
//                 <div className="space-y-3">
//                   {/* Website */}
//                   <div className="flex items-start">
//                     <GlobeIcon />
//                     <div className="ml-2">
//                       <p className="text-sm text-gray-500">Website</p>
//                       <a 
//                         href={companyInfo.website} 
//                         target="_blank" 
//                         rel="noopener noreferrer"
//                         className="text-blue-600 hover:text-blue-800 hover:underline"
//                       >
//                         {companyInfo.website}
//                       </a>
//                     </div>
//                   </div>
                  
//                   {/* Email Pattern */}
//                   <div className="flex items-start">
//                     <MailIcon />
//                     <div className="ml-2">
//                       <p className="text-sm text-gray-500">Email Pattern</p>
//                       <p className="text-gray-900 font-mono text-sm bg-gray-100 px-2 py-1 rounded inline-block">
//                         {companyInfo.emailPattern}
//                       </p>
//                     </div>
//                   </div>
                  
//                   {/* Phone */}
//                   {companyInfo.phone && (
//                     <div className="flex items-start">
//                       <PhoneIcon />
//                       <div className="ml-2">
//                         <p className="text-sm text-gray-500">Phone</p>
//                         <a 
//                           href={`tel:${companyInfo.phone}`}
//                           className="text-blue-600 hover:text-blue-800 hover:underline"
//                         >
//                           {companyInfo.phone}
//                         </a>
//                       </div>
//                     </div>
//                   )}
//                 </div>
//               </div>
              
//               {/* Location Information */}
//               <div className="space-y-4">
//                 <h4 className="font-semibold text-gray-800 mb-3">Location</h4>
                
//                 <div className="space-y-3">
//                   {/* Full Address */}
//                   {(companyInfo.address || companyInfo.location) && (
//                     <div className="flex items-start">
//                       <LocationIcon />
//                       <div className="ml-2">
//                         <p className="text-sm text-gray-500">Address</p>
//                         <p className="text-gray-900">
//                           {companyInfo.address || companyInfo.location}
//                           {companyInfo.city && `, ${companyInfo.city}`}
//                           {companyInfo.state && `, ${companyInfo.state}`}
//                           {companyInfo.postalCode && ` ${companyInfo.postalCode}`}
//                           {companyInfo.country && `, ${companyInfo.country}`}
//                         </p>
//                       </div>
//                     </div>
//                   )}
                  
//                   {/* Coordinates */}
//                   {companyInfo.latitude && companyInfo.longitude && (
//                     <div className="flex items-start">
//                       <MapPinIcon />
//                       <div className="ml-2">
//                         <p className="text-sm text-gray-500">Coordinates</p>
//                         <p className="text-gray-900 font-mono text-sm">
//                           {companyInfo.latitude}, {companyInfo.longitude}
//                         </p>
//                         <a 
//                           href={`https://www.google.com/maps?q=${companyInfo.latitude},${companyInfo.longitude}`}
//                           target="_blank"
//                           rel="noopener noreferrer"
//                           className="text-blue-600 hover:text-blue-800 hover:underline text-sm"
//                         >
//                           View on Maps
//                         </a>
//                       </div>
//                     </div>
//                   )}
//                 </div>
//               </div>
              
//               {/* Company Stats & Details */}
//               <div className="space-y-4">
//                 <h4 className="font-semibold text-gray-800 mb-3">Company Details</h4>
                
//                 <div className="space-y-3">
//                   {/* Employee Count */}
//                   <div>
//                     <p className="text-sm text-gray-500">Employees Found</p>
//                     <p className="text-2xl font-bold text-teal-600">{companyInfo.employeeCount}</p>
//                   </div>
                  
//                   {/* Founded */}
//                   {companyInfo.founded && (
//                     <div>
//                       <p className="text-sm text-gray-500">Founded</p>
//                       <p className="text-gray-900">{companyInfo.founded}</p>
//                     </div>
//                   )}
                  
//                   {/* Revenue */}
//                   {companyInfo.revenue && (
//                     <div>
//                       <p className="text-sm text-gray-500">Revenue</p>
//                       <p className="text-gray-900">{companyInfo.revenue}</p>
//                     </div>
//                   )}
                  
//                   {/* Social Links */}
//                   {(companyInfo.linkedin || companyInfo.twitter || companyInfo.facebook) && (
//                     <div>
//                       <p className="text-sm text-gray-500 mb-2">Social Media</p>
//                       <div className="flex gap-3">
//                         {companyInfo.linkedin && (
//                           <a 
//                             href={companyInfo.linkedin}
//                             target="_blank"
//                             rel="noopener noreferrer"
//                             className="text-blue-600 hover:text-blue-800"
//                             title="LinkedIn"
//                           >
//                             <LinkedinIcon />
//                           </a>
//                         )}
//                         {companyInfo.twitter && (
//                           <a 
//                             href={companyInfo.twitter}
//                             target="_blank"
//                             rel="noopener noreferrer"
//                             className="text-blue-400 hover:text-blue-600"
//                             title="Twitter"
//                           >
//                             <TwitterIcon />
//                           </a>
//                         )}
//                         {companyInfo.facebook && (
//                           <a 
//                             href={companyInfo.facebook}
//                             target="_blank"
//                             rel="noopener noreferrer"
//                             className="text-blue-700 hover:text-blue-900"
//                             title="Facebook"
//                           >
//                             <FacebookIcon />
//                           </a>
//                         )}
//                       </div>
//                     </div>
//                   )}
//                 </div>
//               </div>
//             </div>
            
//             {/* Email Addresses Section */}
//             {companyInfo.emailAddresses && companyInfo.emailAddresses.length > 0 && (
//               <div className="mt-6 pt-6 border-t border-gray-200">
//                 <h4 className="font-semibold text-gray-800 mb-3">Found Email Addresses</h4>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
//                   {companyInfo.emailAddresses.map((email, index) => (
//                     <div key={index} className="flex items-center">
//                       <MailIcon />
//                       <a 
//                         href={`mailto:${email}`}
//                         className="ml-2 text-blue-600 hover:text-blue-800 hover:underline text-sm"
//                       >
//                         {email}
//                       </a>
//                     </div>
//                   ))}
//                 </div>
//               </div>
//             )}
            
//             {/* Departments & Seniority */}
//             <div className="mt-6 pt-6 border-t border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-6">
//               <div>
//                 <h4 className="font-semibold text-gray-800 mb-3">Departments Found</h4>
//                 <div className="flex flex-wrap gap-2">
//                   {companyInfo.departments.length > 0 ? (
//                     companyInfo.departments.map((dept, index) => (
//                       <span 
//                         key={index}
//                         className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"
//                       >
//                         {dept}
//                       </span>
//                     ))
//                   ) : (
//                     <span className="text-gray-500 text-sm">No departments specified</span>
//                   )}
//                 </div>
//               </div>
              
//               <div>
//                 <h4 className="font-semibold text-gray-800 mb-3">Seniority Distribution</h4>
//                 <div className="space-y-2">
//                   {Object.entries(companyInfo.seniorityLevels).length > 0 ? (
//                     Object.entries(companyInfo.seniorityLevels).map(([level, count]) => (
//                       <div key={level} className="flex justify-between items-center">
//                         <span className="text-sm text-gray-600">{level}</span>
//                         <span className="text-sm font-medium text-gray-900 bg-gray-100 px-2 py-1 rounded">
//                           {count}
//                         </span>
//                       </div>
//                     ))
//                   ) : (
//                     <span className="text-gray-500 text-sm">No seniority data available</span>
//                   )}
//                 </div>
//               </div>
//             </div>
            
//             {/* Technologies if available */}
//             {companyInfo.technologies && companyInfo.technologies.length > 0 && (
//               <div className="mt-6 pt-6 border-t border-gray-200">
//                 <h4 className="font-semibold text-gray-800 mb-3">Technologies Used</h4>
//                 <div className="flex flex-wrap gap-2">
//                   {companyInfo.technologies.map((tech, index) => (
//                     <span 
//                       key={index}
//                       className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800"
//                     >
//                       {tech}
//                     </span>
//                   ))}
//                 </div>
//               </div>
//             )}
//           </div>
//         )}

//         {/* Results Table */}
//         <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
//           <div className="px-6 py-4 bg-gray-50 border-b">
//             <h3 className="text-lg font-semibold text-gray-800">
//               Employee Details ({getResultsCount()} results)
//             </h3>
//           </div>
          
//           <div className="overflow-x-auto">
//             <table className="w-full">
//               <thead className="bg-gray-50">
//                 <tr>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     #
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Name
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Email
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Position
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Company
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Phone
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     LinkedIn
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Confidence
//                   </th>
//                   <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Status
//                   </th>
//                 </tr>
//               </thead>
//               <tbody className="bg-white divide-y divide-gray-200">
//                 {Array.isArray(resultData) && resultData.map((lead, index) => (
//                   <tr key={index} className="hover:bg-gray-50 transition-colors">
//                     <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
//                       {index + 1}
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       <div className="flex items-center">
//                         <UserIcon />
//                         <div className="ml-2">
//                           <div className="font-medium">
//                             {lead.fullName || `${lead.firstName || ''} ${lead.lastName || ''}`.trim() || 'N/A'}
//                           </div>
//                           {lead.department && (
//                             <div className="text-xs text-gray-500">{lead.department}</div>
//                           )}
//                         </div>
//                       </div>
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       {lead.email ? (
//                         <div className="flex items-center">
//                           <MailIcon />
//                           <a 
//                             href={`mailto:${lead.email}`}
//                             className="ml-2 text-blue-600 hover:text-blue-800 hover:underline"
//                           >
//                             {lead.email}
//                           </a>
//                         </div>
//                       ) : (
//                         <span className="text-gray-400 text-xs">No email</span>
//                       )}
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       <div className="max-w-xs">
//                         {lead.position ? (
//                           <div>
//                             <div className="font-medium">{lead.position}</div>
//                             {lead.seniority && (
//                               <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mt-1">
//                                 {lead.seniority}
//                               </span>
//                             )}
//                           </div>
//                         ) : (
//                           <span className="text-gray-400 text-xs">No position</span>
//                         )}
//                       </div>
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       {lead.company ? (
//                         <div className="flex items-center">
//                           <BuildingIcon />
//                           <span className="ml-2 font-medium">{lead.company}</span>
//                         </div>
//                       ) : (
//                         <span className="text-gray-400 text-xs">No company</span>
//                       )}
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       {lead.phoneNumber ? (
//                         <div className="flex items-center">
//                           <PhoneIcon />
//                           <a 
//                             href={`tel:${lead.phoneNumber}`}
//                             className="ml-2 text-blue-600 hover:text-blue-800 hover:underline"
//                           >
//                             {lead.phoneNumber}
//                           </a>
//                         </div>
//                       ) : (
//                         <span className="text-gray-400 text-xs">No phone</span>
//                       )}
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       {lead.linkedinProfile ? (
//                         <a
//                           href={lead.linkedinProfile}
//                           target="_blank"
//                           rel="noopener noreferrer"
//                           className="inline-flex items-center text-blue-600 hover:text-blue-800 hover:underline"
//                         >
//                           <LinkedinIcon />
//                           <span className="ml-1">Profile</span>
//                         </a>
//                       ) : (
//                         <span className="text-gray-400 text-xs">No profile</span>
//                       )}
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       {lead.confidence ? (
//                         <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getConfidenceColor(lead.confidence)}`}>
//                           {lead.confidence}%
//                         </span>
//                       ) : (
//                         <span className="text-gray-400 text-xs">Unknown</span>
//                       )}
//                     </td>
//                     <td className="px-6 py-4 text-sm text-gray-900">
//                       <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getVerificationStatusColor(lead.verificationStatus)}`}>
//                         {lead.verificationStatus || 'Unknown'}
//                       </span>
//                     </td>
//                   </tr>
//                 ))}
//               </tbody>
//             </table>
//           </div>
//         </div>

//         {/* Stats Summary */}
//         <div className="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
//           <div className="bg-white rounded-lg p-4 shadow">
//             <div className="text-2xl font-bold text-gray-900">{getResultsCount()}</div>
//             <div className="text-sm text-gray-600">Total Leads</div>
//           </div>
//           <div className="bg-white rounded-lg p-4 shadow">
//             <div className="text-2xl font-bold text-green-600">
//               {Array.isArray(resultData) ? resultData.filter(lead => lead.email).length : 0}
//             </div>
//             <div className="text-sm text-gray-600">With Email</div>
//           </div>
//           <div className="bg-white rounded-lg p-4 shadow">
//             <div className="text-2xl font-bold text-blue-600">
//               {Array.isArray(resultData) ? resultData.filter(lead => lead.phoneNumber).length : 0}
//             </div>
//             <div className="text-sm text-gray-600">With Phone</div>
//           </div>
//           <div className="bg-white rounded-lg p-4 shadow">
//             <div className="text-2xl font-bold text-purple-600">
//               {Array.isArray(resultData) ? resultData.filter(lead => lead.linkedinProfile).length : 0}
//             </div>
//             <div className="text-sm text-gray-600">With LinkedIn</div>
//           </div>
//         </div>

//         {/* Footer */}
//         <div className="mt-6 text-center">
//           <p className="text-sm text-gray-500">
//             Results powered by <span className="text-teal-600 font-semibold">Brainmine.AI</span> â€¢ 
//             Extracted on {new Date().toLocaleDateString()} at {new Date().toLocaleTimeString()}
//           </p>
//         </div>
//       </div>
//     </div>
//   );
// };

// export default DomainSearchResults;


import React, { useEffect, useState } from 'react';

// --- ICONS (No changes to icons) ---
const ArrowLeftIcon = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12,19 5,12 12,5"/></svg>);
const DownloadIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>);
const CheckIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-600"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>);
const RefreshIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>);
const MailIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>);
const PhoneIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>);
const UserIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>);
const BuildingIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 21h18"/><path d="M5 21V7l8-4v18"/><path d="M19 21V11l-6-4"/></svg>);
const LinkedinIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>);
const ExternalLinkIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15,3 21,3 21,9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>);
const GlobeIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>);
const IndustryIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>);
const LocationIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>);
const UsersIcon = () => (<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>);


const DomainSearchResults = ({ resultData, formData, submissionTime, onBack, onNewSearch }) => {
  const [dynamicColumns, setDynamicColumns] = useState([]);
  const [companyInfo, setCompanyInfo] = useState(null);
  const [personData, setPersonData] = useState([]);

  useEffect(() => {
    let processedPersons = [];
    let processedCompany = null;
    
    // --- DATA PROCESSING LOGIC ---
    if (typeof resultData === 'object' && resultData !== null) {
      // Standard structures with separate company/person objects
      if (resultData.company && resultData.persons) {
        processedCompany = resultData.company;
        processedPersons = Array.isArray(resultData.persons) ? resultData.persons : [];
      } else if (resultData.companyData && resultData.employeeData) {
        processedCompany = resultData.companyData;
        processedPersons = Array.isArray(resultData.employeeData) ? resultData.employeeData : [];
      } else if (Array.isArray(resultData)) {
        processedPersons = resultData;
      } else {
        // Heuristic search for person/company data in unknown object structures
        Object.keys(resultData).forEach(key => {
          if (Array.isArray(resultData[key]) && resultData[key].length > 0) {
            const firstItem = resultData[key][0];
            if (typeof firstItem === 'object' && (firstItem.email || firstItem.name || firstItem.fullName)) {
              processedPersons = resultData[key];
            }
          } else if (typeof resultData[key] === 'object' && resultData[key] !== null && !processedCompany) {
            if (resultData[key].domain || resultData[key].name || resultData[key].website) {
              processedCompany = resultData[key];
            }
          }
        });
      }
    }
    
    // --- NEW FALLBACK LOGIC ---
    // If we have persons but still no company info, try to get it from the first person.
    if (!processedCompany && processedPersons.length > 0) {
      const firstPerson = processedPersons[0];
      const companyDataFromPerson = {};

      // Check for common company-related fields in the person object
      if (firstPerson.company) companyDataFromPerson.name = firstPerson.company;
      if (firstPerson.companyName) companyDataFromPerson.name = firstPerson.companyName;
      if (firstPerson.company_name) companyDataFromPerson.name = firstPerson.company_name;
      if (firstPerson.domain) companyDataFromPerson.domain = firstPerson.domain;
      if (firstPerson.website) companyDataFromPerson.website = firstPerson.website;
      if (firstPerson.company_linkedin_url) companyDataFromPerson.linkedin = firstPerson.company_linkedin_url;
      if (firstPerson.industry) companyDataFromPerson.industry = firstPerson.industry;
      if (firstPerson.company_size) companyDataFromPerson.size = firstPerson.company_size;

      // If we found any data, set it as the processedCompany
      if (Object.keys(companyDataFromPerson).length > 0) {
        processedCompany = companyDataFromPerson;
      }
    }

    setPersonData(processedPersons);
    setCompanyInfo(processedCompany);

    if (processedPersons.length > 0) {
      const allKeys = new Set();
      processedPersons.forEach(item => { if (typeof item === 'object' && item !== null) { Object.keys(item).forEach(key => allKeys.add(key)); } });
      const knownKeys = [ '#', 'name', 'fullName', 'firstName', 'lastName', 'email', 'position', 'title', 'job_title', 'company', 'companyName', 'company_name', 'domain', 'website', 'phoneNumber', 'phone', 'linkedin', 'linkedinProfile', 'confidence', 'verificationStatus', 'seniority', 'department', 'industry', 'company_size', 'company_linkedin_url' ];
      const additionalKeys = Array.from(allKeys).filter(key => !knownKeys.includes(key));
      setDynamicColumns(additionalKeys);
    } else {
      setDynamicColumns([]);
    }
  }, [resultData]);

  // Helper function to format keys for display
  const formatLabel = (key) => {
    return key
      .replace(/([A-Z])/g, ' $1') // Add space before capital letters
      .replace(/_/g, ' ') // Replace underscores with spaces
      .replace(/\b\w/g, char => char.toUpperCase()); // Capitalize first letter of each word
  };

  // Helper to get an icon for a specific company detail key
  const getDetailIcon = (key) => {
    const lowerKey = key.toLowerCase();
    if (lowerKey.includes('domain') || lowerKey.includes('website')) return <GlobeIcon />;
    if (lowerKey.includes('industry')) return <IndustryIcon />;
    if (lowerKey.includes('location') || lowerKey.includes('address') || lowerKey.includes('city') || lowerKey.includes('country')) return <LocationIcon />;
    if (lowerKey.includes('size') || lowerKey.includes('employees')) return <UsersIcon />;
    if (lowerKey.includes('linkedin')) return <LinkedinIcon />;
    if (lowerKey.includes('name')) return <BuildingIcon />;
    return null;
  };
  
  // (All other helper functions like downloadAsCSV, getConfidenceColor, etc. remain the same)
  const downloadAsCSV = () => { if (!personData || personData.length === 0) return; const allKeys = new Set(); personData.forEach(item => { if (typeof item === 'object' && item !== null) { Object.keys(item).forEach(key => allKeys.add(key)); } }); const headers = Array.from(allKeys); const csvContent = [ headers.join(','), ...personData.map(row => headers.map(header => `"${String(row[header] || '').replace(/"/g, '""')}"`).join(',')) ].join('\n'); const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.setAttribute('href', url); link.setAttribute('download', `domain_leads_${formData.domain}_${new Date().toISOString().split('T')[0]}.csv`); document.body.appendChild(link); link.click(); document.body.removeChild(link); };
  const downloadAsJSON = () => { const jsonData = { searchParameters: formData, submissionTime: submissionTime, extractionDate: new Date().toISOString(), totalResults: personData.length, companyInfo: companyInfo, personData: personData, }; const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' }); const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.setAttribute('href', url); link.setAttribute('download', `domain_leads_${formData.domain}_${new Date().toISOString().split('T')[0]}.json`); document.body.appendChild(link); link.click(); document.body.removeChild(link); };
  const getConfidenceColor = (confidence) => { if (confidence >= 80) return 'bg-green-100 text-green-800'; if (confidence >= 60) return 'bg-yellow-100 text-yellow-800'; return 'bg-red-100 text-red-800'; };
  const getVerificationStatusColor = (status) => { switch (status?.toLowerCase()) { case 'verified': return 'bg-green-100 text-green-800'; case 'invalid': return 'bg-red-100 text-red-800'; case 'unknown': return 'bg-gray-100 text-gray-800'; default: return 'bg-gray-100 text-gray-600'; } };
  const renderCellValue = (value, columnName) => { if (value === null || value === undefined) { return <span className="text-gray-400 text-xs">N/A</span>; } const stringValue = String(value); if (stringValue.length > 150) { return ( <div className="group relative"> <div className="truncate"> {stringValue.substring(0, 150)}... </div> <div className="invisible group-hover:visible absolute z-10 w-80 p-3 bg-gray-900 text-white text-sm rounded-lg shadow-lg -top-2 left-0 transform -translate-y-full"> {stringValue} <div className="absolute top-full left-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div> </div> </div> ); } return <span>{stringValue}</span>; };
  const staticColumnCount = 9;

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 animate-slideIn">
      <div className="max-w-7xl mx-auto">
        {/* --- HEADER SECTION --- */}
        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
          <div className="flex flex-col lg:flex-row lg:items-center justify-between mb-6">
            <div className="flex items-center mb-4 lg:mb-0">
              <button onClick={onBack} className="mr-4 p-2 text-gray-600 hover:text-gray-800 transition-colors rounded-lg hover:bg-gray-100"><ArrowLeftIcon /></button>
              <div>
                <h1 className="text-2xl lg:text-3xl font-bold text-gray-800">Domain Lead Results</h1>
                <p className="text-gray-600 mt-1">
                  Found <span className="font-bold text-teal-600">{personData.length} leads</span> from{' '}
                  <span className="font-medium text-teal-600">{formData.domain}</span>
                </p>
              </div>
            </div>
            <div className="flex items-center space-x-4">
              <div className="text-center">
                <div className="flex items-center justify-center w-12 h-12 bg-green-100 rounded-full mb-2"><CheckIcon /></div>
                <p className="text-sm text-gray-600">Completed in {submissionTime}s</p>
              </div>
            </div>
          </div>
          <div className="flex flex-wrap gap-3">
             <button onClick={downloadAsCSV} className="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"><DownloadIcon /><span className="ml-2">Download CSV</span></button>
             <button onClick={downloadAsJSON} className="flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"><DownloadIcon /><span className="ml-2">Download JSON</span></button>
             <button onClick={onNewSearch} className="flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"><RefreshIcon /><span className="ml-2">New Search</span></button>
          </div>
        </div>

        {/* --- COMPANY DETAILS SECTION (Now more reliable) --- */}
        {companyInfo && Object.keys(companyInfo).length > 0 && (
          <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <h2 className="text-xl font-bold text-gray-800 mb-4">Company Details</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4">
              {Object.entries(companyInfo).map(([key, value]) => {
                if (!value) return null; // Don't show empty fields
                
                const isLink = typeof value === 'string' && (value.startsWith('http') || value.startsWith('www'));
                const href = isLink ? (value.startsWith('www') ? `https://${value}` : value) : null;
                const Icon = getDetailIcon(key);

                return (
                  <div key={key} className="text-sm">
                    <div className="flex items-center text-gray-500">
                      {Icon && <span className="mr-2">{Icon}</span>}
                      <span className="font-medium">{formatLabel(key)}</span>
                    </div>
                    <div className="text-gray-900 mt-1 pl-6 break-words">
                      {isLink ? (
                        <a href={href} target="_blank" rel="noopener noreferrer" className="inline-flex items-center text-blue-600 hover:text-blue-800 hover:underline">
                          <span>{value}</span>
                          <span className="ml-1"><ExternalLinkIcon /></span>
                        </a>
                      ) : (
                        <span>{Array.isArray(value) ? value.join(', ') : String(value)}</span>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* --- EMPLOYEE DETAILS TABLE --- */}
        <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
          <div className="px-6 py-4 bg-gray-50 border-b">
            <h3 className="text-lg font-semibold text-gray-800">
              Employee Details ({personData.length} results)
            </h3>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">LinkedIn</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Confidence</th>
                  <th className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                  {dynamicColumns.map(column => (
                    <th key={column} className="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{formatLabel(column)}</th>
                  ))}
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {personData.length > 0 ? (
                  personData.map((lead, index) => (
                    <tr key={index} className="hover:bg-gray-50 transition-colors">
                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{index + 1}</td>
                      <td className="px-6 py-4 text-sm text-gray-900"><div className="flex items-center"><UserIcon /><div className="ml-2"><div className="font-medium">{lead.fullName || lead.name || `${lead.firstName || ''} ${lead.lastName || ''}`.trim() || 'N/A'}</div>{lead.department && (<div className="text-xs text-gray-500">{lead.department}</div>)}</div></div></td>
                      <td className="px-6 py-4 text-sm text-gray-900">{lead.email ? (<div className="flex items-center"><MailIcon /><a href={`mailto:${lead.email}`} className="ml-2 text-blue-600 hover:text-blue-800 hover:underline">{lead.email}</a></div>) : (<span className="text-gray-400 text-xs">No email</span>)}</td>
                      <td className="px-6 py-4 text-sm text-gray-900"><div className="max-w-xs">{lead.position || lead.title || lead.job_title ? (<div><div className="font-medium">{lead.position || lead.title || lead.job_title}</div>{lead.seniority && (<span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mt-1">{lead.seniority}</span>)}</div>) : (<span className="text-gray-400 text-xs">No position</span>)}</div></td>
                      <td className="px-6 py-4 text-sm text-gray-900">{lead.company || lead.companyName || lead.company_name ? (<div className="flex items-center"><BuildingIcon /><span className="ml-2 font-medium">{lead.company || lead.companyName || lead.company_name}</span></div>) : (<span className="text-gray-400 text-xs">No company</span>)}</td>
                      <td className="px-6 py-4 text-sm text-gray-900">{lead.phoneNumber || lead.phone ? (<div className="flex items-center"><PhoneIcon /><a href={`tel:${lead.phoneNumber || lead.phone}`} className="ml-2 text-blue-600 hover:text-blue-800 hover:underline">{lead.phoneNumber || lead.phone}</a></div>) : (<span className="text-gray-400 text-xs">No phone</span>)}</td>
                      <td className="px-6 py-4 text-sm text-gray-900">{lead.linkedinProfile || lead.linkedin ? (<a href={lead.linkedinProfile || lead.linkedin} target="_blank" rel="noopener noreferrer" className="inline-flex items-center text-blue-600 hover:text-blue-800 hover:underline"><LinkedinIcon /><span className="ml-1">Profile</span></a>) : (<span className="text-gray-400 text-xs">No profile</span>)}</td>
                      <td className="px-6 py-4 text-sm text-gray-900">{lead.confidence !== undefined && lead.confidence !== null ? (<span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getConfidenceColor(lead.confidence)}`}>{lead.confidence}%</span>) : (<span className="text-gray-400 text-xs">Unknown</span>)}</td>
                      <td className="px-6 py-4 text-sm text-gray-900"><span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getVerificationStatusColor(lead.verificationStatus)}`}>{lead.verificationStatus || 'Unknown'}</span></td>
                      {dynamicColumns.map(column => (<td key={column} className="px-6 py-4 text-sm text-gray-900"><div className="max-w-xs">{renderCellValue(lead[column], column)}</div></td>))}
                    </tr>
                  ))
                ) : (
                  <tr><td colSpan={staticColumnCount + dynamicColumns.length} className="px-6 py-12 text-center text-sm text-gray-500">No lead data found for this domain.</td></tr>
                )}
              </tbody>
            </table>
          </div>
        </div>

        {/* --- FOOTER SECTION --- */}
        <div className="mt-6 text-center">
          <p className="text-sm text-gray-500">
            Results powered by <span className="text-teal-600 font-semibold">Brainmine.AI</span> â€¢ 
            Extracted on {new Date().toLocaleDateString()} at {new Date().toLocaleTimeString()}
          </p>
        </div>
      </div>
    </div>
  );
};

export default DomainSearchResults;